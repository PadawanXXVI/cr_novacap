{% extends "base.html" %}

{% block title %}Alterar Processo - CR/NOVACAP{% endblock %}

{% block content %}
<section class="alterar-processo-section" style="max-width: 800px; margin: 0 auto;">
    <h1>Alterar Processo</h1>
    <p class="text-center" style="color: var(--text-muted); margin-bottom: 1rem;">
        Atualize o status e as informa√ß√µes de movimenta√ß√£o deste processo.
    </p>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('processos_bp.alterar_processo', id_processo=processo.id_processo) }}">
        <!-- üîí Token CSRF obrigat√≥rio -->
        {{ csrf_token() }}

        <!-- N√∫mero do Processo -->
        <div class="form-group">
            <label for="numero_processo">N√∫mero do Processo</label>
            <input type="text" id="numero_processo" name="numero_processo"
                   value="{{ processo.numero_processo }}" readonly
                   style="background-color: #f9f9f9; border: 1px solid #ddd;">
        </div>

        <!-- Status Atual -->
        <div class="form-group">
            <label for="status_atual">Status Atual</label>
            <input type="text" id="status_atual" name="status_atual"
                   value="{{ processo.status_atual or '---' }}" readonly
                   style="background-color: #f9f9f9; border: 1px solid #ddd;">
        </div>

        <!-- Novo Status -->
        <div class="form-group">
            <label for="novo_status">Novo Status</label>
            <select id="novo_status" name="novo_status" required>
                <option value="">Selecione</option>
                {% for s in status %}
                    <option value="{{ s.descricao }}">{{ s.descricao }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Observa√ß√£o -->
        <div class="form-group">
            <label for="observacao">Observa√ß√£o</label>
            <textarea id="observacao" name="observacao" rows="4" placeholder="Descreva a altera√ß√£o realizada..." required></textarea>
        </div>

        <!-- Data da Movimenta√ß√£o -->
        <div class="form-group">
            <label for="data_movimentacao">Data da Movimenta√ß√£o</label>
            <input type="date" id="data_movimentacao" name="data_movimentacao" required>
        </div>

        <!-- Respons√°vel T√©cnico -->
        <div class="form-group">
            <label for="responsavel_tecnico">Respons√°vel T√©cnico</label>
            <select id="responsavel_tecnico" name="responsavel_tecnico" required>
                <option value="">Selecione</option>
                {% for u in usuarios %}
                    <option value="{{ u.id_usuario }}">{{ u.nome }} ({{ u.usuario }})</option>
                {% endfor %}
            </select>
        </div>

        <!-- Bot√µes -->
        <div class="button-group" style="margin-top: 2rem;">
            <button type="submit" class="btn-primary">Salvar Altera√ß√£o</button>

            <a href="{{ url_for('processos_bp.dashboard_processos') }}">
                <button type="button" class="btn-secondary">Tela de Totais</button>
            </a>

            <a href="{{ url_for('main_bp.logout') }}">
                <button type="button" class="btn-danger">Sair do Sistema</button>
            </a>
        </div>
    </form>
</section>
{% endblock %}
